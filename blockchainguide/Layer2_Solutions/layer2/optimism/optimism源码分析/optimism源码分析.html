<!DOCTYPE html>
<html lang="zh" dir="ltr"><head><title>optimism源码分析</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Serif SC:wght@400;700&amp;family=Noto Sans SC:ital,wght@0,400;0,600;1,400;1,600&amp;family=JetBrains Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="量化投资技术文档"/><meta property="og:title" content="optimism源码分析"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="optimism源码分析"/><meta name="twitter:description" content="godorz.info/2022/04/optimism-notes/ github.com/ethereum-optimism/optimism-tutorial 社区基于optimism的开发教程 layer2交易费对比 www.theblockbeats.info/news/29797 本文基于github.com/ethereum-optimism/optimism/commit/b1cc033b6d3827df47b606e3f89fdbf2fa2cccc4 撰写 学习目的，有意将此扩展方案适配到本公司基于以太坊更改的项目中以提高扩展性，更好的支持应用生态。 Optimistic ..."/><meta property="og:description" content="godorz.info/2022/04/optimism-notes/ github.com/ethereum-optimism/optimism-tutorial 社区基于optimism的开发教程 layer2交易费对比 www.theblockbeats.info/news/29797 本文基于github.com/ethereum-optimism/optimism/commit/b1cc033b6d3827df47b606e3f89fdbf2fa2cccc4 撰写 学习目的，有意将此扩展方案适配到本公司基于以太坊更改的项目中以提高扩展性，更好的支持应用生态。 Optimistic ..."/><meta property="og:image:alt" content="godorz.info/2022/04/optimism-notes/ github.com/ethereum-optimism/optimism-tutorial 社区基于optimism的开发教程 layer2交易费对比 www.theblockbeats.info/news/29797 本文基于github.com/ethereum-optimism/optimism/commit/b1cc033b6d3827df47b606e3f89fdbf2fa2cccc4 撰写 学习目的，有意将此扩展方案适配到本公司基于以太坊更改的项目中以提高扩展性，更好的支持应用生态。 Optimistic ..."/><meta property="og:image" content="https://https://mindcarver.top/static/og-image.png"/><meta property="og:image:url" content="https://https://mindcarver.top/static/og-image.png"/><meta name="twitter:image" content="https://https://mindcarver.top/static/og-image.png"/><meta property="og:image:type" content="image/.png"/><meta property="twitter:domain" content="https://mindcarver.top"/><meta property="og:url" content="https://https//mindcarver.top/blockchainguide/Layer2_Solutions/layer2/optimism/optimism源码分析/optimism源码分析"/><meta property="twitter:url" content="https://https//mindcarver.top/blockchainguide/Layer2_Solutions/layer2/optimism/optimism源码分析/optimism源码分析"/><link rel="icon" href="../../../../../static/icon.png"/><meta name="description" content="godorz.info/2022/04/optimism-notes/ github.com/ethereum-optimism/optimism-tutorial 社区基于optimism的开发教程 layer2交易费对比 www.theblockbeats.info/news/29797 本文基于github.com/ethereum-optimism/optimism/commit/b1cc033b6d3827df47b606e3f89fdbf2fa2cccc4 撰写 学习目的，有意将此扩展方案适配到本公司基于以太坊更改的项目中以提高扩展性，更好的支持应用生态。 Optimistic ..."/><meta name="generator" content="Quartz"/><link href="../../../../../index.css" rel="stylesheet" type="text/css" data-persist="true"/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvbWluZGNhcnZlci5naXRodWIuaW8vbWluZGNhcnZlci5naXRodWIuaW8vcXVhcnR6L2NvbXBvbmVudHMvc3R5bGVzIiwic291cmNlcyI6WyJtZXJtYWlkLmlubGluZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFHRjtFQUNFOzs7QUFLRjtFQUNFO0VBQ0E7OztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFJSjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTs7QUFJRjtFQUNFO0VBQ0E7RUFDQSIsInNvdXJjZXNDb250ZW50IjpbIi5leHBhbmQtYnV0dG9uIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBmbG9hdDogcmlnaHQ7XG4gIHBhZGRpbmc6IDAuNHJlbTtcbiAgbWFyZ2luOiAwLjNyZW07XG4gIHJpZ2h0OiAwOyAvLyBOT1RFOiByaWdodCB3aWxsIGJlIHNldCBpbiBtZXJtYWlkLmlubGluZS50c1xuICBjb2xvcjogdmFyKC0tZ3JheSk7XG4gIGJvcmRlci1jb2xvcjogdmFyKC0tZGFyayk7XG4gIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgYm9yZGVyOiAxcHggc29saWQ7XG4gIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgb3BhY2l0eTogMDtcbiAgdHJhbnNpdGlvbjogMC4ycztcblxuICAmID4gc3ZnIHtcbiAgICBmaWxsOiB2YXIoLS1saWdodCk7XG4gICAgZmlsdGVyOiBjb250cmFzdCgwLjMpO1xuICB9XG5cbiAgJjpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGJvcmRlci1jb2xvcjogdmFyKC0tc2Vjb25kYXJ5KTtcbiAgfVxuXG4gICY6Zm9jdXMge1xuICAgIG91dGxpbmU6IDA7XG4gIH1cbn1cblxucHJlIHtcbiAgJjpob3ZlciA+IC5leHBhbmQtYnV0dG9uIHtcbiAgICBvcGFjaXR5OiAxO1xuICAgIHRyYW5zaXRpb246IDAuMnM7XG4gIH1cbn1cblxuI21lcm1haWQtY29udGFpbmVyIHtcbiAgcG9zaXRpb246IGZpeGVkO1xuICBjb250YWluOiBsYXlvdXQ7XG4gIHotaW5kZXg6IDk5OTtcbiAgbGVmdDogMDtcbiAgdG9wOiAwO1xuICB3aWR0aDogMTAwdnc7XG4gIGhlaWdodDogMTAwdmg7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIGRpc3BsYXk6IG5vbmU7XG4gIGJhY2tkcm9wLWZpbHRlcjogYmx1cig0cHgpO1xuICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuNSk7XG5cbiAgJi5hY3RpdmUge1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgfVxuXG4gICYgPiAjbWVybWFpZC1zcGFjZSB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICB0b3A6IDUwJTtcbiAgICBsZWZ0OiA1MCU7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7XG4gICAgaGVpZ2h0OiA4MHZoO1xuICAgIHdpZHRoOiA4MHZ3O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgICAmID4gLm1lcm1haWQtY29udGVudCB7XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcyBlYXNlO1xuICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICBtaW4taGVpZ2h0OiAyMDBweDtcbiAgICAgIG1pbi13aWR0aDogMjAwcHg7XG5cbiAgICAgIHByZSB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgfVxuXG4gICAgICBzdmcge1xuICAgICAgICBtYXgtd2lkdGg6IG5vbmU7XG4gICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAmID4gLm1lcm1haWQtY29udHJvbHMge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAyMHB4O1xuICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZ2FwOiA4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgIHotaW5kZXg6IDI7XG5cbiAgICAgIC5tZXJtYWlkLWNvbnRyb2wtYnV0dG9uIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIHdpZHRoOiAzMnB4O1xuICAgICAgICBoZWlnaHQ6IDMycHg7XG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgY29sb3I6IHZhcigtLWRhcmspO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICBmb250LWZhbWlseTogdmFyKC0tYm9keUZvbnQpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuXG4gICAgICAgICY6aG92ZXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIH1cblxuICAgICAgICAmOmFjdGl2ZSB7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdHlsZSB0aGUgcmVzZXQgYnV0dG9uIGRpZmZlcmVudGx5XG4gICAgICAgICY6bnRoLWNoaWxkKDIpIHtcbiAgICAgICAgICB3aWR0aDogYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAwIDEycHg7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0= */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" data-persist="true"/><script src="../../../../../prescript.js" type="application/javascript" data-persist="true"></script><script type="application/javascript" data-persist="true">const fetchData = fetch("../../../../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://https://mindcarver.top/index.xml"/></head><body data-slug="blockchainguide/Layer2_Solutions/layer2/optimism/optimism源码分析/optimism源码分析"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../../../../..">量化投资技术文档</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>搜索</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="搜索些什么" placeholder="搜索些什么"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="暗色模式"><title>暗色模式</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="亮色模式"><title>亮色模式</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="阅读模式"><title>阅读模式</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-256"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>探索</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-256" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../../../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../../blockchainguide/">区块链技术指南</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../../blockchainguide/Layer2_Solutions/">Layer2_Solutions</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../../blockchainguide/Layer2_Solutions/layer2/">layer2</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../../blockchainguide/Layer2_Solutions/layer2/optimism/">optimism</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../../blockchainguide/Layer2_Solutions/layer2/optimism/optimism源码分析/">optimism源码分析</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>optimism源码分析</a></div></nav><h1 class="article-title">optimism源码分析</h1><p show-comma="true" class="content-meta"><time datetime="2026-01-12T10:57:07.432Z">2026年1月12日</time><span>23分钟阅读</span></p></div></div><article class="popover-hint"><blockquote>
<p><a href="https://godorz.info/2022/04/optimism-notes/" class="external">https://godorz.info/2022/04/optimism-notes/<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p><a href="https://github.com/ethereum-optimism/optimism-tutorial" class="external">https://github.com/ethereum-optimism/optimism-tutorial<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> 社区基于optimism的开发教程</p>
<p>layer2交易费对比 <a href="https://www.theblockbeats.info/news/29797" class="external">https://www.theblockbeats.info/news/29797<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</blockquote>
<p>本文基于<a href="https://github.com/ethereum-optimism/optimism/commit/b1cc033b6d3827df47b606e3f89fdbf2fa2cccc4" class="external">https://github.com/ethereum-optimism/optimism/commit/b1cc033b6d3827df47b606e3f89fdbf2fa2cccc4<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> 撰写</p>
<blockquote>
<p>学习目的，有意将此扩展方案适配到本公司基于以太坊更改的项目中以提高扩展性，更好的支持应用生态。</p>
</blockquote>
<h2 id="optimistic-rollup-概述">Optimistic Rollup 概述<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#optimistic-rollup-概述" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>乐观汇总是一种第2层可扩展性技术，可在不牺牲安全性或分散性的情况下增加以太坊的计算和存储容量。交易数据在链上提交，但在链下执行。如果链外执行中存在错误，可以在链上提交错误证明，以纠正错误并保护用户资金。同样，除非有争议，否则你不会上法庭，除非有错误，否则你也不会在链上执行交易。</p>
<h2 id="系统概览">系统概览<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#系统概览" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Optimism 协议中的智能合约可以分为几个关键组件。我们将在下面更详细地讨论每个组件。</p>
<ul>
<li>链：第 1 层上的合约，它持有第 2 层交易的顺序，以及对相关第 2 层状态根的承诺</li>
<li>验证：第 1 层上的合约，它实现了对交易结果提出质疑的过程。</li>
<li>bridge：促进第 1 层和第 2 层之间消息传递的合约</li>
<li>Predeploys：一组基本合约，在系统的创世状态下部署并可用。这些合约类似于以太坊的预编译，但它们是用 Solidity 编写的，并且可以在前缀为 0x42 的地址中找到。</li>
</ul>
<h2 id="链合约">链合约<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#链合约" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>该链由一组运行在以太坊主网上的合约组成。这些合约存储以下有序列表：</p>
<ul>
<li>应用于 L2 状态的所有事务的有序列表。</li>
<li>提议的状态根将由每笔交易的应用产生。</li>
<li>从 L1 发送到 L2 的交易，等待包含在有序列表中。</li>
</ul>
<p>该链由以下合约构成：</p>
<p>CanonicalTransactionChain (opens new window) (CTC)：</p>
<p>Canonical Transaction Chain (CTC) 合约是一个只能附加的交易日志，<strong>必须应用于 OVM 状态</strong>。它通过将交易写入链存储容器的 CTC:batches 实例来定义交易的顺序。 CTC 还允许任何帐户 enqueue() 一个 L2 交易，Sequencer 最终必须将其附加到汇总状态。</p>
<h3 id="statecommitmentchain-opens-new-windowscc"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L1/rollup/StateCommitmentChain.sol" class="external"><code>StateCommitmentChain</code> (opens new window)<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>(SCC)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#statecommitmentchain-opens-new-windowscc" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>状态承诺链 (SCC) 合约包含一个提议的状态根列表，提议者断言这些状态根是规范交易链 (CTC) 中每笔交易的结果。这里的元素与 CTC 中的交易是 1:1 对应的，应该是链下通过规范交易逐一应用计算出来的唯一状态根。</p>
<h3 id="chainstoragecontainer"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L1/rollup/ChainStorageContainer.sol" class="external"><code>ChainStorageContainer</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#chainstoragecontainer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>以“环形缓冲区”数据结构的形式提供可重复使用的存储，它将覆盖不再需要的存储槽。部署了三个 Chain Storage Container，两个由 CTC 控制，一个由 SCC 控制。</p>
<h3 id="验证合约">验证合约<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#验证合约" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>在上一节中，我们提到链包括每个交易产生的建议状态根列表。在这里，我们将更多地解释这些建议是如何产生的，以及我们如何信任它们。</p>
<p>简而言之：如果提议的状态根不是执行交易的正确结果，那么验证者（运行 Optimism“全节点”的任何人）可以发起交易结果挑战。如果交易结果被成功证明是错误的，Verifier 将从资金中获得奖励，Sequencer 必须将其作为保证金。</p>
<p>::: 注意该系统仍在编写中，因此这些细节可能会发生变化:::</p>
<h3 id="bondmanager合约">bondmanager合约<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#bondmanager合约" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>bondmanager合约以 ERC20 代币的形式处理来自担保提议者的存款。它还处理验证者在挑战过程中花费的 gas 成本的核算。如果挑战成功，有问题的提议者的保证金将被削减，验证者的 gas 费用将被退还</p>
<h3 id="bridge合约">bridge合约<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#bridge合约" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>主要实现了L1和L2消息传递。</p>
<h3 id="l1crossdomainmessenger"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L1/messaging/L1CrossDomainMessenger.sol" class="external"><code>L1CrossDomainMessenger</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l1crossdomainmessenger" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>L1 Cross Domain Messenger (L1xDM) 合约将消息从 L1 发送到 L2，并将消息从 L2 中继到 L1。如果从 L1 发送到 L2 的消息因超过 L2 时期的气体限制而被拒绝，可以通过该合约的重放功能重新提交。</p>
<h3 id="l2crossdomainmessenger"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L2/messaging/L2CrossDomainMessenger.sol" class="external"><code>L2CrossDomainMessenger</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l2crossdomainmessenger" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>L2 Cross Domain Messenger (L2xDM) 合约将消息从 L2 发送到 L1，并且是通过 L1 Cross Domain Messenger 发送的 L2 消息的入口点。</p>
<h2 id="标准桥">标准桥<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#标准桥" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>消息传递的一种常见情况是在 L1 和 Optimism 之间“传输”ERC-20 代币或 ETH。为了将代币存入 Optimism，桥将它们锁定在 L1 上并在 Optimism 中铸造等价代币。为了提取代币，桥会销毁 Optimism 代币并释放锁定的 L1 代币。<a href="https://community.optimism.io/docs/developers/bridge/standard-bridge/" class="external">更多细节在这里<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h3 id="l1standardbridge"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L1/messaging/L1StandardBridge.sol" class="external"><code>L1StandardBridge</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l1standardbridge" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>标准桥的 L1 部分。负责完成 L2 的提款并开始将 ETH 和兼容的 ERC20 存入 L2。</p>
<h3 id="l2standardbridge"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L2/messaging/L2StandardBridge.sol" class="external"><code>L2StandardBridge</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l2standardbridge" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>标准网桥的 L2 部分。负责完成 L1 的存款并启动 L2 的 ETH 和合规 ERC20 提款。</p>
<h3 id="l2standardtokenfactory"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L2/messaging/L2StandardTokenFactory.sol" class="external"><code>L2StandardTokenFactory</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l2standardtokenfactory" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>用于创建与标准桥兼容并在标准桥上工作的 L1 ERC20 的标准 L2 令牌表示的工厂合同。请参阅此处了解更多信息（打开新窗口）。</p>
<h3 id="预部署合约">预部署合约<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#预部署合约" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>“Predeploys”是一组基本的 L2 合约，它们在系统的创世状态下部署并可用。这些合约类似于以太坊的预编译，但它们是用 Solidity 编写的，可以在 OVM 中以 0x42 为前缀的地址找到。</p>
<p>在 Solidity 库 Lib_PredeployAddresses (opens new window) 以及 @eth-optimism/contracts 包中作为预部署导出可以查找预部署。</p>
<p>预先部署了以下具体合同：</p>
<h3 id="ovm_l1messagesender"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L2/predeploys/iOVM_L1MessageSender.sol" class="external"><code>OVM_L1MessageSender</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ovm_l1messagesender" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>L1MessageSender 是在 L2 上运行的预部署合约。在执行从 L1 到 L2 的跨域交易期间，它返回通过 Canonical Transaction Chain 的 enqueue() 函数将消息发送到 L2 的 L1 帐户（EOA 或合约）的地址。</p>
<p>请注意，该合约不是用 Solidity 编写的。但是，上面链接的界面仍然可以正常工作。通过这种方式，它类似于 EVM 的预部署。</p>
<p>#</p>
<h3 id="ovm_l2tol1messagepasser"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L2/predeploys/OVM_L2ToL1MessagePasser.sol" class="external"><code>OVM_L2ToL1MessagePasser</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ovm_l2tol1messagepasser" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>L2 到 L1 消息传递器是一个实用程序合约，它有助于 L2 上消息的 L1 证明。 L1 Cross Domain Messenger 在其 _verifyStorageProof 函数中执行此证明，该函数验证此合约的 sentMessages 映射中交易哈希的存在</p>
<h3 id="ovm_sequencerfeevault"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/L2/predeploys/OVM_SequencerFeeVault.sol" class="external"><code>OVM_SequencerFeeVault</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ovm_sequencerfeevault" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>该合约持有支付给定序器的费用，直到有足够的交易成本证明将它们发送到 L1 的交易成本是合理的，在那里它们被用来支付 L1 交易成本（主要是将所有 L2 交易数据作为 CALLDATA 在 L1 上发布的成本）。</p>
<h3 id="lib_addressmanager"><a href="https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/contracts/libraries/resolver/Lib_AddressManager.sol" class="external"><code>Lib_AddressManager</code><svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lib_addressmanager" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>这是一个存储名称与其地址之间的映射的库。它由 L1CrossDomainMessenger 使用。</p>
<h2 id="sequencer">sequencer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#sequencer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>目前，Optimism 在 Optimism 上运行唯一的排序器。这并不意味着 Optimism 可以审查用户交易。然而，随着时间的推移，仍然希望将排序器去中心化，完全消除 Optimism 的作用，以便任何人都可以作为区块生产者参与网络。</p>
<p>目前sequencer只有一个，后面会通过经济机制和治理机制以一定频率轮换或者通过BFT来支持多个sequencer</p>
<p><a href="https://github.com/ethereum-optimism/optimistic-specs" class="external">optimism spec仓库<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="如何工作的">如何工作的<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#如何工作的" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Optimism 块存储在合约（CanonicalTransactionChain）的列表中（以太坊链上），（<a href="https://etherscan.io/address/0x5E4e65926BA27467555EB562121fac00D24E9dD2%EF%BC%89%EF%BC%8C%E4%BB%96%E6%8A%8A%E8%BF%99%E4%B8%AA%E5%90%88%E7%BA%A6%E5%8F%AB%E5%81%9A%E9%93%BE%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E9%87%8D%E7%BB%84%EF%BC%8COptimism%E4%B9%9F%E4%BC%9A%E9%87%8D%E7%BB%84%EF%BC%8C%E7%9B%AE%E5%89%8D%E9%85%8D%E7%BD%AE50%E4%B8%AA%E5%8C%BA%E5%9D%97" class="external">https://etherscan.io/address/0x5E4e65926BA27467555EB562121fac00D24E9dD2），他把这个合约叫做链，如果以太坊重组，Optimism也会重组，目前配置50个区块<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="区块的产生">区块的产生<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#区块的产生" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>sequencer 产生区块，它做以下事情：</p>
<ul>
<li>提供即时交易确认和状态更新</li>
<li>构造并执行L2区块</li>
<li>向L1提交用户交易</li>
</ul>
<p>sequencer没有内存池，事务按照接收顺序立即接受或拒绝。当用户将他们的交易发送到sequencer时，sequencer检查交易是否有效（即支付足够的费用），然后将交易应用到其本地状态作为pending块（多少笔交易作为一个块？？？？）。这些待处理的区块会定期以大批量提交给以太坊进行最终确定。该批处理过程通过将固定成本分摊到给定批内的所有交易上，显著降低了总交易费用。sequencer还应用了一些基本的压缩技术，以最小化发布到以太坊的数据量。</p>
<p>因为sequencer被赋予了对L2链的优先写访问权，所以sequencer可以提供一个强有力的保证，即一旦它决定了一个新的待决块，什么状态将被最终确定。结果，L2状态可以非常快速地可靠地更新。这样做的好处包括快速、即时的用户体验，以及近乎实时的Uniswap价格更新。</p>
<p>或者，用户可以完全跳过sequencer，通过以太坊交易将其交易直接提交到CanonicalTransactionChain。这通常更昂贵，因为提交此交易的固定成本完全由用户支付，并且不会在许多不同的交易中摊销。然而，这种替代（不发给sequencer，直接发到合约中）的提交方法有一个优点，即可以抵抗sequencer的审查。即使sequencer正在主动审查用户，用户也可以继续在Optimism上发送事务。</p>
<p>目前的sequencer 其实还是官方在操作，唯一一个能发布交易的角色。</p>
<h2 id="区块的执行">区块的执行<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#区块的执行" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>optimism 节点直接从CanonicalTransactionChain合约中保存的块的附加列表中直接下载块, 这个列表中的区块是由sequencer提供的，然后全网的optimism节点去挑战这个区块数据.</p>
<p>Optimism 节点由两个主要组件组成，即以太坊数据索引器和 Optimism 客户端软件.即以太坊数据索引器(搜索上面合约中的区块数据，根据合约发出的事件）和Optimism客户端软件。以太坊数据索引器，也称为“数据传输层”（<a href="https://github.com/ethereum-optimism/optimism/tree/develop/packages/data-transport-layer%EF%BC%89%EF%BC%88%E6%88%96DTL%EF%BC%89%EF%BC%8C%E4%BB%8E%E5%8F%91%E5%B8%83%E5%88%B0CanonicalTransactionChain%E5%90%88%E7%BA%A6%E7%9A%84%E5%8C%BA%E5%9D%97%E9%87%8D%E5%BB%BAOptimism%E5%8C%BA%E5%9D%97%E9%93%BE%E3%80%82**DTL%E6%90%9C%E7%B4%A2%E7%94%B1CanonicalTransactionChain%E5%8F%91%E5%87%BA%E7%9A%84%E4%BA%8B%E4%BB%B6**%EF%BC%8C%E8%AF%A5%E4%BA%8B%E4%BB%B6%E8%A1%A8%E7%A4%BA%E5%B7%B2%E5%8F%91%E5%B8%83%E6%96%B0%E7%9A%84Optimism%E5%9D%97%E3%80%82%E7%84%B6%E5%90%8E%EF%BC%8C%E5%AE%83%E6%A3%80%E6%9F%A5%E5%8F%91%E5%87%BA%E8%BF%99%E4%BA%9B%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BA%8B%E5%8A%A1%EF%BC%8C%E4%BB%A5%E6%A0%87%E5%87%86%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%9D%97%E6%A0%BC%E5%BC%8F%E9%87%8D%E5%BB%BA%E5%B7%B2%E5%8F%91%E5%B8%83%E7%9A%84%E5%9D%97%EF%BC%88https://ethereum.org/en/developers/docs/blocks/#block-anatomy%EF%BC%89%E3%80%82" class="external">https://github.com/ethereum-optimism/optimism/tree/develop/packages/data-transport-layer）（或DTL），从发布到CanonicalTransactionChain合约的区块重建Optimism区块链。**DTL搜索由CanonicalTransactionChain发出的事件**，该事件表示已发布新的Optimism块。然后，它检查发出这些事件的事务，以标准以太坊块格式重建已发布的块（https://ethereum.org/en/developers/docs/blocks/#block-anatomy）。<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>Optimism节点的第二部分，Optimism客户端软件，是Geth的一个几乎完全普通的版本（<a href="https://github.com/ethereum/go-ethereum%EF%BC%89%E3%80%82%E8%BF%99%E6%84%8F%E5%91%B3%E7%9D%80%E4%B9%90%E8%A7%82%E4%B8%BB%E4%B9%89%E5%87%A0%E4%B9%8E%E7%AD%89%E5%90%8C%E4%BA%8E%E4%BB%A5%E5%A4%AA%E5%9D%8A%E3%80%82%E7%89%B9%E5%88%AB%E6%98%AF%EF%BC%8COptimism%E5%85%B1%E4%BA%AB%E7%9B%B8%E5%90%8C%E7%9A%84%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88https://ethereum.org/en/developers/docs/evm/%EF%BC%89%EF%BC%8C%E7%9B%B8%E5%90%8C%E7%9A%84%E5%B8%90%E6%88%B7%E5%92%8C%E7%8A%B6%E6%80%81%E7%BB%93%E6%9E%84%EF%BC%88https://ethereum.org/en/developers/docs/accounts/%EF%BC%89%EF%BC%8C%E4%BB%A5%E5%8F%8A%E7%9B%B8%E5%90%8C%E7%9A%84%E7%87%83%E6%B0%94%E8%AE%A1%E9%87%8F%E6%9C%BA%E5%88%B6%E5%92%8C%E6%94%B6%E8%B4%B9%E6%97%B6%E9%97%B4%E8%A1%A8%EF%BC%88https://ethereum.org/en/developers/docs/gas/%EF%BC%89%E3%80%82%E6%88%91%E4%BB%AC%E5%B0%86%E6%AD%A4%E6%9E%B6%E6%9E%84%E7%A7%B0%E4%B8%BA%E2%80%9CEVM%E7%AD%89%E6%95%88%E2%80%9D%EF%BC%88https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306%EF%BC%89%EF%BC%8C%E8%BF%99%E6%84%8F%E5%91%B3%E7%9D%80%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%B7%A5%E5%85%B7%EF%BC%88%E5%8D%B3%E4%BD%BF%E6%98%AF%E6%9C%80%E5%A4%8D%E6%9D%82%E7%9A%84%E5%B7%A5%E5%85%B7%EF%BC%89%E2%80%9C%E5%8F%AA%E4%B8%8E%E4%B9%90%E8%A7%82%E4%B8%BB%E4%B9%89%E4%B8%80%E8%B5%B7%E5%B7%A5%E4%BD%9C%E2%80%9D%E3%80%82" class="external">https://github.com/ethereum/go-ethereum）。这意味着乐观主义几乎等同于以太坊。特别是，Optimism共享相同的以太坊虚拟机（https://ethereum.org/en/developers/docs/evm/），相同的帐户和状态结构（https://ethereum.org/en/developers/docs/accounts/），以及相同的燃气计量机制和收费时间表（https://ethereum.org/en/developers/docs/gas/）。我们将此架构称为“EVM等效”（https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306），这意味着大多数以太坊工具（即使是最复杂的工具）“只与乐观主义一起工作”。<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>乐观客户端软件不断监视DTL的新索引块。当索引新块时，客户端软件将下载并执行其中包含的交易。在客户端上执行交易的过程与以太坊上的交易相同：我们加载optimism状态，将交易应用于该状态，然后记录所得状态的变化。然后，针对由DTL索引的每个新块重复此过程。</p>
<p>我的理解，sequencer接收交易，组成区块扔到L1 合约上，optimism节点 监听合约上的区块，再下载下来根据以太坊的格式重组这些块，实际还会执行里面的交易，就是验证的过程。如果不对就可以挑战他。</p>
<h2 id="在层之间桥接资产">在层之间桥接资产<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#在层之间桥接资产" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Optimism的设计使得用户可以在<strong>Optimism和以太坊上</strong>的智能合约之间发送任意消息。这使得在两个网络之间转移包括ERC20代币在内的资产成为可能。这种通信发生的确切机制取决于消息发送的方向。</p>
<p>Optimism在标准网桥中使用此功能，允许用户将资产（ERC20s和ETH）从以太坊存入Optimism，并允许将资产从Optimism提取回以太坊。开发者如何使用标准桥（<a href="https://community.optimism.io/docs/developers/bridge/standard-bridge/%EF%BC%89" class="external">https://community.optimism.io/docs/developers/bridge/standard-bridge/）<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="从ethereum转向optimism">从Ethereum转向Optimism<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#从ethereum转向optimism" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>要从以太坊向Optimism发送消息，<strong>用户只需在以太坊上触发CanonicalTransactionChain合约</strong>，即可在Optimism块上创建新块。有关更多上下文，请参见上面关于块生产的章节。用户创建的块可以包括看起来来自生成块的地址的事务。</p>
<h2 id="从optimism-回到-ethereum">从optimism 回到 ethereum<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#从optimism-回到-ethereum" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Optimism上的合约不可能像以太坊合约在Optimism中生成交易一样，在以太坊上轻松生成交易。因此，将数据从Optimism发送回以太坊的过程稍微复杂一些。我们必须能够对以太坊上的合约<strong>做出关于乐观状态的可证明声明</strong>，而不是自动生成经过验证的交易。</p>
<p>关于Optimism状态的可证明声明需要以Optimism的状态trie根（<a href="https://medium.com/@eiki1212/ethereum-state-trie-architecture-explained-a30237009d4e%EF%BC%89%E7%9A%84%E5%BD%A2%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E6%89%BF%E8%AF%BA%EF%BC%88https://en.wikipedia.org/wiki/Commitment_scheme%EF%BC%89%E3%80%82%E4%B9%90%E8%A7%82%E4%B8%BB%E4%B9%89%E7%9A%84%E7%8A%B6%E6%80%81%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%8C%BA%E5%9D%97%E4%B9%8B%E5%90%8E%E9%83%BD%E4%BC%9A%E6%9B%B4%E6%96%B0%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%BF%99%E7%A7%8D%E6%89%BF%E8%AF%BA%E4%B9%9F%E4%BC%9A%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%8C%BA%E5%9D%97%E5%90%8E%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%E3%80%82%E6%89%BF%E8%AF%BA%E5%AE%9A%E6%9C%9F%E5%8F%91%E5%B8%83%EF%BC%88%E5%A4%A7%E7%BA%A6%E6%AF%8F%E5%B0%8F%E6%97%B6%E4%B8%80%E6%AC%A1%E6%88%96%E4%B8%A4%E6%AC%A1%EF%BC%89%E5%88%B0%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E5%90%8D%E4%B8%BAStateCommitmentChain%E7%9A%84%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%88https://etherscan.io/address/0xBe5dAb4A2e9cd0F27300dB4aB94BeE3A233AEB19%EF%BC%89" class="external">https://medium.com/@eiki1212/ethereum-state-trie-architecture-explained-a30237009d4e）的形式进行加密承诺（https://en.wikipedia.org/wiki/Commitment_scheme）。乐观主义的状态在每个区块之后都会更新，因此这种承诺也会在每个区块后发生变化。承诺定期发布（大约每小时一次或两次）到以太坊上名为StateCommitmentChain的智能合约（https://etherscan.io/address/0xBe5dAb4A2e9cd0F27300dB4aB94BeE3A233AEB19）<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>用户可以使用这些承诺来生成关于乐观状态的Merkle树证明（<a href="https://en.wikipedia.org/wiki/Merkle_tree%EF%BC%89%E3%80%82%E8%BF%99%E4%BA%9B%E8%AF%81%E6%98%8E%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E7%9A%84%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%E3%80%82Optimism%E7%BB%B4%E6%8A%A4%E4%B8%80%E4%B8%AA%E6%96%B9%E4%BE%BF%E7%9A%84%E8%B7%A8%E9%93%BE%E9%80%9A%E4%BF%A1%E5%90%88%E5%90%8C%EF%BC%8C%E5%8D%B3L1CrossDomainMessenger%EF%BC%88https://etherscan.io/address/0x25ace71c97B33Cc4729CF772ae268934F7ab5fA1%EF%BC%89%EF%BC%8C%E5%AE%83%E5%8F%AF%E4%BB%A5%E4%BB%A3%E8%A1%A8%E5%85%B6%E4%BB%96%E5%90%88%E5%90%8C%E9%AA%8C%E8%AF%81%E8%BF%99%E4%BA%9B%E8%AF%81%E6%98%8E%E3%80%82" class="external">https://en.wikipedia.org/wiki/Merkle_tree）。这些证明可以通过以太坊上的智能合约进行验证。Optimism维护一个方便的跨链通信合同，即L1CrossDomainMessenger（https://etherscan.io/address/0x25ace71c97B33Cc4729CF772ae268934F7ab5fA1），它可以代表其他合同验证这些证明。<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>这些证明可用于在特定块高度上对Optimism上的任何合约的存储中的数据进行可验证的陈述。然后可以使用此基本功能使Optimism上的合约向以太坊上的合约发送消息。L2ToL1MessagePasser（<a href="https://explorer.optimism.io/address/0x4200000000000000000000000000000000000000%EF%BC%89%E5%A5%91%E7%BA%A6%EF%BC%88%E9%A2%84%E5%85%88%E9%83%A8%E7%BD%B2%E5%88%B0Optimism%E7%BD%91%E7%BB%9C%EF%BC%89%E5%8F%AF%E7%94%B1Optimism%E4%B8%8A%E7%9A%84%E5%A5%91%E7%BA%A6%E7%94%A8%E4%BA%8E%E5%9C%A8Optimism%E7%8A%B6%E6%80%81%E4%B8%8B%E5%AD%98%E5%82%A8%E6%B6%88%E6%81%AF%E3%80%82%E7%84%B6%E5%90%8E%EF%BC%8C%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E5%90%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E7%9A%84%E5%90%88%E7%BA%A6%E8%AF%81%E6%98%8E%EF%BC%8COptimism%E4%B8%8A%E7%9A%84%E7%BB%99%E5%AE%9A%E5%90%88%E7%BA%A6%E5%AE%9E%E9%99%85%E4%B8%8A%E6%84%8F%E5%91%B3%E7%9D%80%E9%80%9A%E8%BF%87%E6%98%BE%E7%A4%BA%E8%AF%A5%E6%B6%88%E6%81%AF%E7%9A%84%E5%93%88%E5%B8%8C%E5%B7%B2%E5%AD%98%E5%82%A8%E5%9C%A8L2ToL1MessagePasser%E5%90%88%E7%BA%A6%E4%B8%AD%E6%9D%A5%E5%8F%91%E9%80%81%E6%9F%90%E4%BA%9B%E7%BB%99%E5%AE%9A%E6%B6%88%E6%81%AF" class="external">https://explorer.optimism.io/address/0x4200000000000000000000000000000000000000）契约（预先部署到Optimism网络）可由Optimism上的契约用于在Optimism状态下存储消息。然后，用户可以向以太坊上的合约证明，Optimism上的给定合约实际上意味着通过显示该消息的哈希已存储在L2ToL1MessagePasser合约中来发送某些给定消息<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="故障证明">故障证明<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#故障证明" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>在乐观汇总中，状态承诺被发布到以太坊，没有任何直接证明这些承诺的有效性。相反，这些承诺在一段时间内被视为待定（称为“挑战窗口”）。如果提议的国家承诺在挑战窗口期（目前设定为7天）内未受到挑战，则该承诺被视为最终承诺。一旦承诺被视为最终承诺，以太坊上的智能合约可以安全地接受基于该承诺的乐观主义状态的证明</p>
<p>当状态承诺受到质疑时，可以通过“错误证明”(以前称为“欺诈证明”(<a href="https://github.com/ethereum-optimism/optimistic-specs/discussions/53))%E8%BF%87%E7%A8%8B%E4%BD%BF%E5%85%B6%E6%97%A0%E6%95%88%E3%80%82%E5%A6%82%E6%9E%9C%E8%AF%A5%E6%89%BF%E8%AF%BA%E6%88%90%E5%8A%9F%E5%9C%B0%E5%8F%97%E5%88%B0%E6%8C%91%E6%88%98%EF%BC%8C%E9%82%A3%E4%B9%88%E5%AE%83%E5%B0%86%E8%A2%AB%E4%BB%8E%E7%8A%B6%E6%80%81%E6%89%BF%E8%AF%BA%E9%93%BE%E4%B8%AD%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E7%BB%88%E8%A2%AB%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%8B%9F%E8%AE%AE%E7%9A%84%E6%89%BF%E8%AF%BA%E6%89%80%E5%8F%96%E4%BB%A3%E3%80%82%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%EF%BC%8C%E4%B8%80%E4%B8%AA%E6%88%90%E5%8A%9F%E7%9A%84%E6%8C%91%E6%88%98%E5%B9%B6%E4%B8%8D%E4%BC%9A%E8%AE%A9%E4%B9%90%E8%A7%82%E4%B8%BB%E4%B9%89%E6%9C%AC%E8%BA%AB%E5%80%92%E9%80%80%EF%BC%8C%E8%80%8C%E5%8F%AA%E4%BC%9A%E8%AE%A9%E4%B9%90%E8%A7%82%E4%B8%BB%E4%B9%89%E8%80%85%E5%AF%B9%E9%93%BE%E6%9D%A1%E7%9A%84%E7%8A%B6%E6%80%81%E5%81%9A%E5%87%BA%E5%85%AC%E5%BC%80%E7%9A%84%E6%89%BF%E8%AF%BA%E3%80%82%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%92%8C%E4%B9%90%E8%A7%82%E7%9A%84%E7%8A%B6%E6%80%81%E6%98%AF%E4%B8%8D%E5%8F%98%E7%9A%84%EF%BC%8C%E7%94%B1%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E8%AF%81%E6%98%8E%E6%8C%91%E6%88%98%E3%80%82" class="external">https://github.com/ethereum-optimism/optimistic-specs/discussions/53))过程使其无效。如果该承诺成功地受到挑战，那么它将被从状态承诺链中删除，最终被另一个拟议的承诺所取代。值得注意的是，一个成功的挑战并不会让乐观主义本身倒退，而只会让乐观主义者对链条的状态做出公开的承诺。事务的顺序和乐观的状态是不变的，由一个错误证明挑战。<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>作为11月11日EVM等效（<a href="https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306%EF%BC%89%E6%9B%B4%E6%96%B0%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%8C%E7%9B%AE%E5%89%8D%E6%AD%A3%E5%9C%A8%E5%AF%B9%E6%95%85%E9%9A%9C%E9%A2%84%E9%98%B2%E6%B5%81%E7%A8%8B%E8%BF%9B%E8%A1%8C%E9%87%8D%E5%A4%A7%E9%87%8D%E6%96%B0%E5%BC%80%E5%8F%91%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%9C%A8%E5%BD%93%E5%89%8DOptimism%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%B8%8D%E6%B4%BB%E8%B7%83%E3%80%82%E6%9C%89%E5%85%B3%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF%EF%BC%8C%E8%AF%B7%E5%8F%82%E9%98%85Optimism%E7%9A%84%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%EF%BC%88https://community.optimism.io/docs/security-model/%EF%BC%89%E3%80%82%E6%82%A8%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%9C%AC%E7%BD%91%E7%AB%99%E7%9A%84%E2%80%9C%E5%8D%8F%E8%AE%AE%E8%A7%84%E8%8C%83%E2%80%9D%E9%83%A8%E5%88%86%E4%B8%AD%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8E%E4%B8%80%E8%88%AC%E6%95%85%E9%9A%9C%E8%AF%81%E6%98%8E%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BF%A1%E6%81%AF" class="external">https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306）更新的副作用，目前正在对故障预防流程进行重大重新开发，因此在当前Optimism系统中不活跃。有关更多信息，请参阅Optimism的安全模型（https://community.optimism.io/docs/security-model/）。您还可以在本网站的“协议规范”部分中阅读更多关于一般故障证明过程的信息<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h2 id="l2上面的交易fee">l2上面的交易fee<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l2上面的交易fee" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="l2执行费用">L2执行费用<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l2执行费用" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<blockquote>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="text" data-theme="github-light github-dark"><code data-language="text" data-theme="github-light github-dark" style="display:grid;"><span data-line><span>l2_execution_fee = transaction_gas_price * l2_gas_used</span></span></code></pre></figure>
</blockquote>
<p>可以在这个面板上查看 gasprice <a href="https://public-grafana.optimism.io/d/9hkhMxn7z/public-dashboard?orgId=1&amp;refresh=5m" class="external">https://public-grafana.optimism.io/d/9hkhMxn7z/public-dashboard?orgId=1&amp;refresh=5m<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h3 id="l1-数据费用">L1 数据费用<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#l1-数据费用" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Optimism 上的所有交易也都发布到以太坊，这部分数据费用由optimism 用户承担，也是主要的费用 ，基于以下4个因素：</p>
<ul>
<li>以太坊当前的 gas price</li>
<li>将交易发布到以太坊的 gas 成本。这大致与<strong>事务的大小</strong>（以字节为单位）成比例。</li>
<li>以 gas 计价的固定间接费用。当前设置为 2100</li>
<li>一种动态管理费用，按固定数量按比例缩放 L1 费用。当前设置为 1.0。</li>
</ul>
<blockquote>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="text" data-theme="github-light github-dark"><code data-language="text" data-theme="github-light github-dark" style="display:grid;"><span data-line><span>l1_data_fee = l1_gas_price * (tx_data_gas + fixed_overhead) * dynamic_overhead</span></span>
<span data-line> </span>
<span data-line><span>tx_data_gas = count_zero_bytes(tx_data) * 4 + count_non_zero_bytes(tx_data) * 16</span></span></code></pre></figure>
</blockquote>
<p>具体的参数值在这个合约里：<a href="https://optimistic.etherscan.io/address/0x420000000000000000000000000000000000000F#readContract" class="external">https://optimistic.etherscan.io/address/0x420000000000000000000000000000000000000F#readContract<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>同时L1的数据费用无法通过交易类型设置上限，但是最高多不超过25% （这里说明了为什么不超过25）<a href="https://help.optimism.io/hc/en-us/articles/4416677738907-What-happens-if-the-L1-gas-price-spikes-while-a-transaction-is-in-process" class="external">https://help.optimism.io/hc/en-us/articles/4416677738907-What-happens-if-the-L1-gas-price-spikes-while-a-transaction-is-in-process<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<h3 id="关键事">关键事<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关键事" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li>发送交易：
<ul>
<li>在 Optimism 上发送交易的过程与在以太坊上发送交易的过程相同。发送交易时，您应提供大于或等于当前 L2 gas 价格的 gas 价格。与在以太坊上一样，您可以使用 eth_gasPrice RPC 方法查询此 gas 价格。同样，您应该以与在以太坊上设置交易气体限制相同的方式设置您的交易气体限制（例如通过 eth_estimateGas）。</li>
</ul>
</li>
<li>响应价格更新
<ul>
<li>L2 上的 Gas 价格默认为 0.001 Gwei，但如果网络拥堵可以动态增加。发生这种情况时，网络将接受的最低费用会增加。与以太坊不同，Optimism 目前没有内存池来持有费用过低的交易。取而代之的是，Optimism 节点将拒绝交易，消息 Fee too low。您可能需要明确处理这种情况，并在发生这种情况时以新的汽油价格重试交易。</li>
</ul>
</li>
<li>向用户显示费用
<ul>
<li>许多以太坊应用程序通过将 gas 价格乘以 gas 限制来向用户显示预估费用。然而，如前所述，Optimism 的用户需要支付 L2 执行费和 L1 数据费。因此，您应该显示这两种费用的总和，以便为用户提供对交易总成本最准确的估计。
<ul>
<li>您可以使用 SDK（<a href="https://github.com/ethereum-optimism/optimism-tutorial/tree/main/sdk-estimate-gas%EF%BC%89%E3%80%82%E6%88%96%E8%80%85%EF%BC%8C%E6%82%A8%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E4%BD%8D%E4%BA%8E" class="external">https://github.com/ethereum-optimism/optimism-tutorial/tree/main/sdk-estimate-gas）。或者，您可以使用位于<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> 0x420000000000000000000000000000000000000F（打开新窗口）的 GasPriceOracle 预部署智能合约估算 L1 数据费用。 GasPriceOracle 合约（打开新窗口）位于每个 Optimism 网络（主网和测试网）的相同地址。为此，调用 GasPriceOracle.getL1Fee()。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr/>
<h2 id="和optimism合约交互">和optimism合约交互<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#和optimism合约交互" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="查找合约地址">查找合约地址<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#查找合约地址" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><a href="https://community.optimism.io/docs/useful-tools/networks/#api-options-2" class="external">https://community.optimism.io/docs/useful-tools/networks/#api-options-2<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><a href="https://github.com/ethereum-optimism/optimism/tree/master/packages/contracts/deployments/goerli" class="external">测试网部署的合约<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li><a href="https://github.com/ethereum-optimism/optimism/tree/master/packages/contracts" class="external">合约的完整包<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
</ul>
<hr/>
<h2 id="运行本地开发环境">运行本地开发环境<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#运行本地开发环境" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<hr/>
<h2 id="组件">组件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#组件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h2 id="疑问">疑问<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#疑问" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>标准网桥 和 自定义网桥的概念</li>
<li></li>
</ol>
<blockquote>
<p>reference</p>
<p><a href="https://github.com/curryxbo/Arbitrum_Doc_CN%E3%80%82arbitrum" class="external">https://github.com/curryxbo/Arbitrum_Doc_CN。arbitrum<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> 中文资料</p>
<p><a href="https://github.com/guoshijiang/layer2" class="external">https://github.com/guoshijiang/layer2<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> 最全面的layer2跨链学习资料</p>
<p><a href="https://community.optimism.io/docs/how-optimism-works/#moving-from-optimism-to-ethereum" class="external">https://community.optimism.io/docs/how-optimism-works/#moving-from-optimism-to-ethereum<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</blockquote></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>关系图谱</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-91" aria-expanded="true"><h3>目录</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#optimistic-rollup-概述" data-for="optimistic-rollup-概述">Optimistic Rollup 概述</a></li><li class="depth-0"><a href="#系统概览" data-for="系统概览">系统概览</a></li><li class="depth-0"><a href="#链合约" data-for="链合约">链合约</a></li><li class="depth-1"><a href="#statecommitmentchain-opens-new-windowscc" data-for="statecommitmentchain-opens-new-windowscc">StateCommitmentChain (opens new window)(SCC)</a></li><li class="depth-1"><a href="#chainstoragecontainer" data-for="chainstoragecontainer">ChainStorageContainer</a></li><li class="depth-1"><a href="#验证合约" data-for="验证合约">验证合约</a></li><li class="depth-1"><a href="#bondmanager合约" data-for="bondmanager合约">bondmanager合约</a></li><li class="depth-1"><a href="#bridge合约" data-for="bridge合约">bridge合约</a></li><li class="depth-1"><a href="#l1crossdomainmessenger" data-for="l1crossdomainmessenger">L1CrossDomainMessenger</a></li><li class="depth-1"><a href="#l2crossdomainmessenger" data-for="l2crossdomainmessenger">L2CrossDomainMessenger</a></li><li class="depth-0"><a href="#标准桥" data-for="标准桥">标准桥</a></li><li class="depth-1"><a href="#l1standardbridge" data-for="l1standardbridge">L1StandardBridge</a></li><li class="depth-1"><a href="#l2standardbridge" data-for="l2standardbridge">L2StandardBridge</a></li><li class="depth-1"><a href="#l2standardtokenfactory" data-for="l2standardtokenfactory">L2StandardTokenFactory</a></li><li class="depth-1"><a href="#预部署合约" data-for="预部署合约">预部署合约</a></li><li class="depth-1"><a href="#ovm_l1messagesender" data-for="ovm_l1messagesender">OVM_L1MessageSender</a></li><li class="depth-1"><a href="#ovm_l2tol1messagepasser" data-for="ovm_l2tol1messagepasser">OVM_L2ToL1MessagePasser</a></li><li class="depth-1"><a href="#ovm_sequencerfeevault" data-for="ovm_sequencerfeevault">OVM_SequencerFeeVault</a></li><li class="depth-1"><a href="#lib_addressmanager" data-for="lib_addressmanager">Lib_AddressManager</a></li><li class="depth-0"><a href="#sequencer" data-for="sequencer">sequencer</a></li><li class="depth-0"><a href="#如何工作的" data-for="如何工作的">如何工作的</a></li><li class="depth-0"><a href="#区块的产生" data-for="区块的产生">区块的产生</a></li><li class="depth-0"><a href="#区块的执行" data-for="区块的执行">区块的执行</a></li><li class="depth-0"><a href="#在层之间桥接资产" data-for="在层之间桥接资产">在层之间桥接资产</a></li><li class="depth-0"><a href="#从ethereum转向optimism" data-for="从ethereum转向optimism">从Ethereum转向Optimism</a></li><li class="depth-0"><a href="#从optimism-回到-ethereum" data-for="从optimism-回到-ethereum">从optimism 回到 ethereum</a></li><li class="depth-0"><a href="#故障证明" data-for="故障证明">故障证明</a></li><li class="depth-0"><a href="#l2上面的交易fee" data-for="l2上面的交易fee">l2上面的交易fee</a></li><li class="depth-1"><a href="#l2执行费用" data-for="l2执行费用">L2执行费用</a></li><li class="depth-1"><a href="#l1-数据费用" data-for="l1-数据费用">L1 数据费用</a></li><li class="depth-1"><a href="#关键事" data-for="关键事">关键事</a></li><li class="depth-0"><a href="#和optimism合约交互" data-for="和optimism合约交互">和optimism合约交互</a></li><li class="depth-1"><a href="#查找合约地址" data-for="查找合约地址">查找合约地址</a></li><li class="depth-0"><a href="#运行本地开发环境" data-for="运行本地开发环境">运行本地开发环境</a></li><li class="depth-0"><a href="#组件" data-for="组件">组件</a></li><li class="depth-0"><a href="#疑问" data-for="疑问">疑问</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v1.0.0</a> © 2026</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript" data-persist="true">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module" data-persist="true">function E(a,e){if(!a)return;function t(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function n(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}a?.addEventListener("click",t),window.addCleanup(()=>a?.removeEventListener("click",t)),document.addEventListener("keydown",n),window.addCleanup(()=>document.removeEventListener("keydown",n))}function f(a){for(;a.firstChild;)a.removeChild(a.firstChild)}var m=class{constructor(e,t){this.container=e;this.content=t;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),t=this.onMouseMove.bind(this),n=this.onMouseUp.bind(this),o=this.onTouchStart.bind(this),r=this.onTouchMove.bind(this),i=this.onTouchEnd.bind(this),s=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",t),document.addEventListener("mouseup",n),this.container.addEventListener("touchstart",o,{passive:!1}),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("touchend",i),window.addEventListener("resize",s),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",t),()=>document.removeEventListener("mouseup",n),()=>this.container.removeEventListener("touchstart",o),()=>document.removeEventListener("touchmove",r),()=>document.removeEventListener("touchend",i),()=>window.removeEventListener("resize",s))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let t=this.createButton("+",()=>this.zoom(.1)),n=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(n),e.appendChild(o),e.appendChild(t),this.container.appendChild(e)}createButton(e,t){let n=document.createElement("button");return n.textContent=e,n.className="mermaid-control-button",n.addEventListener("click",t),window.addCleanup(()=>n.removeEventListener("click",t)),n}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}onTouchStart(e){if(e.touches.length!==1)return;this.isDragging=!0;let t=e.touches[0];this.startPan={x:t.clientX-this.currentPan.x,y:t.clientY-this.currentPan.y}}onTouchMove(e){if(!this.isDragging||e.touches.length!==1)return;e.preventDefault();let t=e.touches[0];this.currentPan={x:t.clientX-this.startPan.x,y:t.clientY-this.startPan.y},this.updateTransform()}onTouchEnd(){this.isDragging=!1}zoom(e){let t=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),n=this.content.getBoundingClientRect(),o=n.width/2,r=n.height/2,i=t-this.scale;this.currentPan.x-=o*i,this.currentPan.y-=r*i,this.scale=t,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){let t=this.content.querySelector("svg").getBoundingClientRect(),n=t.width/this.scale,o=t.height/this.scale;this.scale=1,this.currentPan={x:(this.container.clientWidth-n)/2,y:(this.container.clientHeight-o)/2},this.updateTransform()}},T=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],y;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;y||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let t=y.default,n=new WeakMap;for(let r of e)n.set(r,r.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let c=n.get(s);c&&(s.innerHTML=c)}let r=T.reduce((s,c)=>(s[c]=window.getComputedStyle(document.documentElement).getPropertyValue(c),s),{}),i=document.documentElement.getAttribute("saved-theme")==="dark";t.initialize({startOnLoad:!1,securityLevel:"loose",theme:i?"dark":"base",themeVariables:{fontFamily:r["--codeFont"],primaryColor:r["--light"],primaryTextColor:r["--darkgray"],primaryBorderColor:r["--tertiary"],lineColor:r["--darkgray"],secondaryColor:r["--secondary"],tertiaryColor:r["--tertiary"],clusterBkg:r["--light"],edgeLabelBackground:r["--highlight"]}}),await t.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let r=0;r<e.length;r++){let v=function(){let g=l.querySelector("#mermaid-space"),h=l.querySelector(".mermaid-content");if(!h)return;f(h);let w=i.querySelector("svg").cloneNode(!0);h.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new m(g,h)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},i=e[r],s=i.parentElement,c=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(c),L=c.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),E(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript" data-persist="true"></script><script src="../../../../../postscript.js" type="module" data-persist="true"></script></html>