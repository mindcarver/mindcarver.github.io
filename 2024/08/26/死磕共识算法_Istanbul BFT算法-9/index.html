<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="死磕共识算法|Istanbul BFT算法">
<meta property="og:type" content="article">
<meta property="og:title" content="死磕共识算法|Istanbul BFT算法">
<meta property="og:url" content="http://example.com/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_Istanbul%20BFT%E7%AE%97%E6%B3%95-9/index.html">
<meta property="og:site_name" content="mindcarver&#39;s blog">
<meta property="og:description" content="死磕共识算法|Istanbul BFT算法">
<meta property="og:locale">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008eGmZEgy1gnximfy066j30oo0gs0vk.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006tNc79gy1g64qqy79jqj30z60najwf.jpg">
<meta property="article:published_time" content="2024-08-26T07:10:40.646Z">
<meta property="article:modified_time" content="2024-08-26T07:14:32.551Z">
<meta property="article:author" content="mindcarver">
<meta property="article:tag" content="共识算法">
<meta property="article:tag" content="IBFT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008eGmZEgy1gnximfy066j30oo0gs0vk.jpg">

<link rel="canonical" href="http://example.com/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_Istanbul%20BFT%E7%AE%97%E6%B3%95-9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>死磕共识算法|Istanbul BFT算法 | mindcarver's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">mindcarver's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_Istanbul%20BFT%E7%AE%97%E6%B3%95-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="mindcarver">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mindcarver's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          死磕共识算法|Istanbul BFT算法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-08-26 15:10:40 / Modified: 15:14:32" itemprop="dateCreated datePublished" datetime="2024-08-26T15:10:40+08:00">2024-08-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">共识算法</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_Istanbul%20BFT%E7%AE%97%E6%B3%95-9/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_Istanbul%20BFT%E7%AE%97%E6%B3%95-9/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>9.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>
            <div class="post-description">死磕共识算法|Istanbul BFT算法</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>死磕共识算法|Istanbul BFT算法</p>
<p>配合以下代码进行阅读：<a target="_blank" rel="noopener" href="https://github.com/blockchainGuide/">https://github.com/blockchainGuide/</a></p>
<p>写文不易，上面给个star，有什么问题可以指出，便于大家交流学习。</p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnximfy066j30oo0gs0vk.jpg" alt="931c0c9307f4692d69da24b7fe6e0bf3"></p>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p><a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/issues/650">Istanbul BFT</a>作为BFT类算法的一种已经有过在以太坊上的实践。虽然Istanbul目前还存在一些<a target="_blank" rel="noopener" href="https://blog.csdn.net/dianyangshu0904/article/details/102195413#%E6%BD%9C%E5%9C%A8%E9%97%AE%E9%A2%98">潜在的问题</a>，但其算法思想和实现还是值得学习和借鉴的。</p>
<blockquote>
<p>源代码：<a target="_blank" rel="noopener" href="https://github.com/jpmorganchase/quorum/tree/master/consensus/istanbul">https://github.com/jpmorganchase/quorum/tree/master/consensus/istanbul</a></p>
</blockquote>
<h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><ul>
<li><strong>Validator</strong>：块的验证者</li>
<li><strong>Proposer</strong>：块验证者中被选择用来出块的</li>
<li><strong>Round</strong>: 共识的轮数。一轮中 Proposer 开始提出一个一个出块建议，然后以提交区块结束。</li>
<li><strong>Proposal</strong>：新的块生成提议</li>
<li><strong>Sequence</strong>：提议的序号。当前序列号大于先前的；块高就是此提议的序列号。</li>
<li><strong>Backlog</strong>：存储未来的共识消息</li>
<li><strong>Round state</strong>: 特定sequence和轮次的共识消息，包括 pre-prepare 消息, prepare 消息, and commit 消息.</li>
<li><strong>Consensus proof</strong>：用来证明块已经通过共识处理的块签名</li>
<li><strong>Snapshot</strong>：上一个时期的验证者投票状态</li>
</ul>
<h3 id="IBFT共识细节"><a href="#IBFT共识细节" class="headerlink" title="IBFT共识细节"></a>IBFT共识细节</h3><p>Proposer 必须在每个 round中连续不断的 生成 block prorosal。</p>
<p>istanbul BFT 包括 3 个阶段的共识：PRE-PREPARE，PREPARE，COMMIT。</p>
<p>容错机制： N &#x3D; 3F +1 ；N表示验证节点，F表示错误节点。</p>
<p>在每轮之前将会以循环的方式选择一个 validator 作为 proposer. 接着 proposer将会提出一个新的 block proposal 并且广播通过 pre-prepare 消息。一旦接受到 pre-prepare消息 ，validators将会进入到 pre-prepared 阶段并且广播 prepare  消息。这个步骤是为了确保 validators 运行在相同的 sequence 和相同的 round 中。当接收到2F+1 的Prepare消息时，validators 进入到 prepared并且广播 commit 消息。此步骤是通知其它节点接受建议的块并将块插入链。 最后，validator等待2F + 1 COMMIT消息进入COMMITTED状态，然后将块插入链。</p>
<p>注意：<strong>Istanbul中 的块是最终的，没有分叉，任何有效的块必须位于主链的某个位置</strong>。</p>
<p>为了防止故障节点从主链生成完全不同的链，每个验证器将2F + 1个接收到的COMMIT签名附加到标头中的extraData字段，然后将其插入链中， 因此，块是可自我验证的，并且也可以支持轻客户端。但是，动态extraData会导致块哈希计算出现问题。由于来自不同验证器的相同块可以具有不同的COMMIT签名集，因此同一块也可以具有不同的块散列。 为了解决这个问题，我们通过排除COMMIT签名部分来计算块哈希。 因此，我们仍然可以保持块&#x2F;块哈希一致性，并将共识证明放在块头中。</p>
<h4 id="共识状态"><a href="#共识状态" class="headerlink" title="共识状态"></a>共识状态</h4><p>Istanbul BFT是一种状态机复制算法。 每个验证器都维护一个状态机副本，以达到块一致性。</p>
<p>一共有以下几种状态：</p>
<ul>
<li><code>NEW ROUND</code>: Proposer发送新的 block proposal。 Validator等待PRE-PREPARE消息。</li>
<li><code>PRE-PREPARED</code>:验证器已收到PRE-PREPARE消息并广播PREPARE消息。 然后它等待2F + 1 个PREFARE或COMMIT消息。</li>
<li><code>PREPARED</code>: 验证器已收到2F + 1个PREPARE消息并广播COMMIT消息。 然后它等待2F + 1 COMMIT消息。</li>
<li><code>COMMITTED</code>:验证器已收到2F + 1个COMMIT消息，并能够将建议的块插入区块链。</li>
<li><code>FINAL COMMITTED</code>:新块已成功插入区块链，validator 已准备好进入下一轮。</li>
<li><code>ROUND CHANGE</code>:验证器正在等待同一个建议的轮数上的2F + 1个ROUND CHANGE消息。</li>
</ul>
<h4 id="状态转换"><a href="#状态转换" class="headerlink" title="状态转换"></a>状态转换</h4><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g64qqy79jqj30z60najwf.jpg" alt="image-20190819094215511"></p>
<ul>
<li><code>NEW ROUND</code> -&gt; <code>PRE-PREPARED</code>:<ul>
<li><strong>Proposer</strong> 从txpool 中收集交易</li>
<li><strong>Proposer</strong>生成块提议并将其广播给验证者。 然后它进入PRE-PREPARED状态。</li>
<li>每个validator在收到具有以下条件的PRE-PREPARE消息后进入PRE-PREPARED：<ul>
<li>块提案来自有效的proposer。</li>
<li>块头有效</li>
<li>block proposal的sequence和round匹配validator的状态</li>
</ul>
</li>
<li><strong>Validator</strong>广播<code>PREPARE</code>消息给其他validators</li>
</ul>
</li>
<li><code>PRE-PREPARED</code> -&gt; <code>PREPARED</code>:<ul>
<li>Validator接收2F + 1个有效的PREPARE消息以进入PREPARED状态。 有效消息符合以下条件：<ul>
<li>sequence 和 round匹配</li>
<li>block hash匹配</li>
<li>消息来自于已知 validators</li>
</ul>
</li>
</ul>
</li>
<li><code>COMMITTED</code> -&gt; <code>FINAL COMMITTED</code>:<ul>
<li>validator 将 2F+1 个提交的签名放到 extraData中并且尝试将区块上链</li>
<li>插入成功后，Validator进入FINAL COMMITTED状态。</li>
</ul>
</li>
<li><code>FINAL COMMITTED</code> -&gt; <code>NEW ROUND</code>:<ul>
<li>验证器选择一个新的提议器并启动一个新的round timer 。</li>
</ul>
</li>
</ul>
<h4 id="Round-change-flow"><a href="#Round-change-flow" class="headerlink" title="Round change flow"></a>Round change flow</h4><ul>
<li>3 个条件将会触发 ROUND CHANGE<ul>
<li>Round change timer 过期</li>
<li>无效 <code>PREPREPARE</code> 消息</li>
<li>块插入失败</li>
</ul>
</li>
<li>当验证器注意到上述条件之一适用时，它会广播ROUND CHANGE消息以及建议的 round number，并等待来自其他验证器的ROUND CHANGE消息。 建议的round number 根据以下条件选择：<ul>
<li>如果验证器已从其peers接收到ROUND CHANGE消息，则它将选择具有F + 1个ROUND CHANGE消息的最大 round number。</li>
<li>否则，它会选择1 +当前的round number作为建议的轮数。</li>
</ul>
</li>
<li>每当验证器在同一个建议的轮数上收到F + 1个ROUND CHANGE消息时，它就会将收到的消息与它自己的一个进行比较。 如果接收的数量较大，验证器将再次使用收到的号码广播ROUND CHANGE消息。</li>
<li>在相同的建议round number上接收到2F + 1个ROUND CHANGE消息后，验证器退出round change loop，计算新的提议者，然后进入NEW ROUND状态。</li>
<li>验证器跳出round change loop的另一个条件是它通过对等同步接收验证的块。</li>
</ul>
<h4 id="Proposer-选择策略"><a href="#Proposer-选择策略" class="headerlink" title="Proposer 选择策略"></a>Proposer 选择策略</h4><p>目前我们支持两种策略：<strong>round robin</strong> 和 <strong>sticky proposer</strong>.。</p>
<ul>
<li>Round robin:在循环设置中，提议者将在每个块和round change中进行更改</li>
<li>Sticky proposer: 在 sticky proposer中, proposal只有在发生一轮变更时才会改变。</li>
</ul>
<h4 id="Validator-列表投票"><a href="#Validator-列表投票" class="headerlink" title="Validator 列表投票"></a>Validator 列表投票</h4><p>使用与Clique类似的验证器投票机制，并复制Clique EIP的大部分内容。 每个epoch交易都会重置验证器投票，这意味着如果授权或取消授权投票仍在进行中，则投票过程将被终止。</p>
<p>对于所有交易块：</p>
<ul>
<li>Proposer可以投一票来建议更改验证人名单。</li>
<li>每个目标受益人的最新提案仅保留一个验证人。</li>
<li>随着链条的进展，投票将被实时统计（允许同时提议）。</li>
<li>达到多数共识的proposals ,VALIDATOR_LIMIT立即生效。</li>
<li>无效的提案不会因客户端实现简单而受到惩罚。</li>
<li>一项生效的提案需要放弃该提案的所有未决投票（赞成和反对），并以 clean state 开始</li>
</ul>
<h4 id="未来的消息和backlog"><a href="#未来的消息和backlog" class="headerlink" title="未来的消息和backlog"></a>未来的消息和backlog</h4><p>在异步网络环境中，可以接收将来无法在当前状态下处理的消息。 例如，验证器可以在NEW ROUND上接收COMMIT消息。 我们将此类消息称为“未来消息”。 当验证程序收到将来的消息时，它会将消息放入其待办事项中，并尽可能在稍后尝试处理。</p>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>为了加速共识过程，在接收PREFARE消息的2F + 1之前接收到2F + 1 COMMIT消息的验证器将跳转到COMMITTED状态，这样就不必等待进一步的PREPARE消息。</p>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p>我们定义以下常量：</p>
<ul>
<li><code>EPOCH_LENGTH</code>:检查点和重置待处理投票之后的块数。<ul>
<li>建议30000使testnet保持类似于主要网络ethash时代。</li>
</ul>
</li>
<li><code>REQUEST_TIMEOUT</code>: 在以毫秒为单位进行轮次更改之前，每个达成一致的超时。</li>
<li><code>BLOCK_PERIOD</code>: 两个连续块之间的最小时间戳差异（秒）。</li>
<li><code>PROPOSER_POLICY</code>:提议者选择策略，默认为round robin.。</li>
<li><code>ISTANBUL_DIGEST</code>:固定的 magic number， 0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365用于Istanbul块识别的块头中的mixDigest。</li>
<li><code>DEFAULT_DIFFICULTY</code>: 默认块难度，设置为0x0000000000000001。</li>
<li><code>EXTRA_VANITY</code>: 固定数量的额外数据前缀字节预留给提议者。<ul>
<li>建议保留当前额外数据容量和&#x2F;或使用的32个字节。</li>
</ul>
</li>
<li><code>NONCE_AUTH</code>: magic nonce number 0xffffffffffffffff投票添加验证器。</li>
<li><code>NONCE_DROP</code>:magic nonce number 0x0000000000000000 投票移除验证器</li>
<li><code>UNCLE_HASH</code>:总是Keccak256（RLP（[]））作为叔叔在PoW之外没有意义。</li>
<li><code>PREPREPARE_MSG_CODE</code>: 固定编号0. PREPREPARE消息的消息代码。</li>
<li><code>COMMIT_MSG_CODE</code>: 固定编号1. COMMIT消息的消息代码。</li>
<li><code>ROUND_CHANGE_MSG_CODE</code>:固定号码2. ROUND CHANGE消息的消息代码。</li>
</ul>
<p>我们还定义了以下每块常量：</p>
<ul>
<li><code>BLOCK_NUMBER</code>: 链中的块高度，其中生成块的高度为0。</li>
<li><code>N</code>: 授权验证人数。</li>
<li><code>F</code>:允许的错误验证器数量。</li>
<li><code>VALIDATOR_INDEX</code>:当前授权验证器的排序列表中的块验证器的索引。</li>
<li><code>VALIDATOR_LIMIT</code>: 传递授权或取消授权提议的验证者数量。<ul>
<li>必须是最低限额（N &#x2F; 2）+ 1才能对链条达成多数共识。</li>
</ul>
</li>
</ul>
<h4 id="块头"><a href="#块头" class="headerlink" title="块头"></a>块头</h4><p>我们没有为伊斯坦布尔BFT发明新的块头。 相反，我们跟随Clique重新调整ethash标头字段，如下所示：</p>
<ul>
<li><p><code>beneficiary</code>: 建议修改验证器列表的地址。</p>
<ul>
<li>应该通常用零填充，仅在投票时修改。</li>
<li>尽管如此，允许使用任意值（即使是无意义的值，例如投票给非验证者），以避免投票机制实施中的额外复杂性。</li>
</ul>
</li>
<li><p><code>nonce</code>:关于受益人领域定义的帐户的提议者提案。</p>
<ul>
<li>应该是NONCE_DROP建议取消授权受益人作为现有验证人。</li>
<li>应该是NONCE_AUTH建议授权受益人作为新的验证人。</li>
<li>必须填充零，NONCE_DROP或NONCE_AUTH</li>
</ul>
</li>
<li><p><code>mixHash</code>: 固定 magic number 0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365 用于伊斯坦布尔区块识别</p>
</li>
<li><p><code>ommersHash</code>:必须是UNCLE_HASH，因为在PoW之外，叔叔没有意义。</p>
</li>
<li><p><code>timestamp</code>:必须至少是父时间戳+ BLOCK_PERIOD</p>
</li>
<li><p><code>difficulty</code>:必须填写0x0000000000000001。</p>
</li>
<li><p><code>extraData</code>: 签名者和RLP编码的伊斯坦布尔额外数据的组合字段，其中伊斯坦布尔额外数据包含验证器列表，proposer seal和 commit seal。 伊斯坦布尔的额外数据定义如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IstanbulExtra <span class="keyword">struct</span> &#123;</span><br><span class="line">	Validators    []common.Address 	<span class="comment">//Validator addresses</span></span><br><span class="line">	Seal          []<span class="type">byte</span>			<span class="comment">//Proposer seal 65 bytes</span></span><br><span class="line">	CommittedSeal [][]<span class="type">byte</span>			<span class="comment">//Committed seal, 65 * len(Validators) bytes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此extraData将采用EXTRA_VANITY |的形式 ISTANBUL_EXTRA其中| 表示用于分隔vanity和伊斯坦布尔额外数据的固定索引（不是分隔符的实际字符）。</p>
<ul>
<li>第一个EXTRA_VANITY字节（固定）可以包含任意提议者vanity数据。</li>
<li>ISTANBUL_EXTRA字节是从RLP（IstanbulExtra）计算的RLP编码的伊斯坦布尔额外数据，其中RLP（）是RLP编码功能，而IstanbulExtra是伊斯坦布尔额外数据。<ul>
<li><code>Validators</code>: 验证器列表，必须按升序排序。</li>
<li><code>Seal</code>: 提议者的header seal 签名。</li>
<li><code>CommittedSeal</code>:提交的签名列表作为共识证明</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Block-hash-proposer-seal-and-committed-seals"><a href="#Block-hash-proposer-seal-and-committed-seals" class="headerlink" title="Block hash, proposer seal, and committed seals"></a>Block hash, proposer seal, and committed seals</h3><p>由于以下原因，Istanbul块哈希计算与ethash块哈希计算不同：</p>
<ol>
<li>提议者需要将提议者密封在extraData中以证明该块由所选提议者签名。</li>
<li>验证者需要将2F + 1个已提交的密封作为extraData中的共识证明，以证明该块已经达成共识。</li>
</ol>
<p>计算仍然类似于ethash块哈希计算，但我们需要处理extraData。 我们按如下方式计算字段：</p>
<h5 id="计算提议者seal"><a href="#计算提议者seal" class="headerlink" title="计算提议者seal"></a>计算提议者seal</h5><p>在提议者密封计算时，committed的密封仍然是未知的，因此我们计算密封与那些未知的密封空。 计算如下：</p>
<ul>
<li><code>Proposer seal</code>: <code>SignECDSA(Keccak256(RLP(Header)), PrivateKey)</code></li>
<li><code>PrivateKey</code>: Proposer’s的私钥</li>
<li><code>Header</code>: 和ethash 的header一样，只不过extradata不一样</li>
<li><code>extraData</code>: <code>vanity | RLP(IstanbulExtra)</code>, 在IstanbulExtra<code>, </code>CommittedSeal<code>and </code>Seal&#96; 是空数组.</li>
</ul>
<h5 id="计算块哈希"><a href="#计算块哈希" class="headerlink" title="计算块哈希"></a>计算块哈希</h5><p>在计算块哈希时，我们需要排除已提交的密封，因为该数据在不同的验证器之间是动态的。 因此，我们在计算哈希时使CommittedSeal为空数组。 计算如下：</p>
<ul>
<li><code>Header</code>: 和ethash 的header一样，只不过extradata不一样</li>
<li><code>extraData</code>: <code>vanity | RLP(IstanbulExtra)</code>, 在IstanbulExtra<code>, </code>CommittedSeal<code>and </code>Seal&#96; 是空数组.</li>
</ul>
<h5 id="共识证明"><a href="#共识证明" class="headerlink" title="共识证明"></a>共识证明</h5><p>在将块插入区块链之前，每个验证器需要从其他验证器收集2F + 1个已提交的密封以构成共识证明。 一旦它收到足够的提交密封，它将填充IstanbulExtra中的CommittedSeal，重新计算extraData，然后将块插入区块链。 请注意，由于已提交的密封可能因不同的来源而不同，因此我们会在计算块哈希时排除该部分，如上一节所述。</p>
<p>Committed seal calculation:</p>
<p>committed seal由每个签名哈希的验证器以及其私钥的COMMIT_MSG_CODE消息代码计算。 计算如下：</p>
<ul>
<li><code>Committed seal</code>: <code>SignECDSA(Keccak256(CONCAT(Hash, COMMIT_MSG_CODE)), PrivateKey)</code>.</li>
<li><code>CONCAT(Hash, COMMIT_MSG_CODE)</code>: 连接 block hash and <code>COMMIT_MSG_CODE</code> bytes.</li>
<li><code>PrivateKey</code>: 签署验证者的私钥。</li>
</ul>
<h3 id="块锁定机制"><a href="#块锁定机制" class="headerlink" title="块锁定机制"></a>块锁定机制</h3><p>引入锁定机制以解决安全问题。 通常，当提议者用块B锁定在某个高度H时，它只能为高度H提出B.另一方面，当验证器被锁定时，它只能在B上投票选择高度H.</p>
<h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><p>锁定锁（B，H）包含一个块及其高度，这意味着它的所有验证器当前被锁定在某个块B和高度H.在下面，我们还使用+表示多于和 - 表示小于。 例如，+ 2&#x2F;3验证器表示超过三分之二的验证器，而-1&#x2F;3验证器表示不到三分之一的验证器。</p>
<h4 id="Lock-and-unlock"><a href="#Lock-and-unlock" class="headerlink" title="Lock and unlock"></a>Lock and unlock</h4><ul>
<li>Lock:验证器在高度为“H”的块“B”上接收到“2F + 1”“PREPARE”消息时被锁定。</li>
<li>Unlock: 验证器在高度“H”处解锁，并在未能将块“B”插入块链时阻止“B”。</li>
</ul>
<h4 id="Protocol-2-3-validators-are-locked-with-Lock-B-H"><a href="#Protocol-2-3-validators-are-locked-with-Lock-B-H" class="headerlink" title="Protocol (+2/3 validators are locked with Lock(B,H))"></a>Protocol (<code>+2/3</code> validators are locked with <code>Lock(B,H)</code>)</h4><ul>
<li><p><code>PRE-PREPARE</code>:</p>
<ul>
<li><p><strong>Proposer</strong>:</p>
<ul>
<li><p>情况1，提议者被锁定：在B上广播PRE-PREPARE，并进入PREPARED状态。</p>
</li>
<li><p>情况2，提议者未被锁定：在块B’上广播PRE-PREPARE。</p>
</li>
</ul>
</li>
<li><p><strong>Validator</strong>:</p>
<ul>
<li>情况1，在现有块上接收PRE-PREPARE：忽略。<ul>
<li>注意：它最终会导致轮次更改，并且提议者将通过同步获得旧块。</li>
</ul>
</li>
<li>情况2，验证器被锁定：<ul>
<li>案例2.1，在B上收到PRE-PREPARE：在B上广播PREPARE</li>
<li>案例2.2，在B’上接收PRE-PREPARE：广播ROUND CHANGE。</li>
</ul>
</li>
<li>情况3，验证器未锁定：<ul>
<li>情况3.1，在B上接收PRE-PREPARE：在B上广播PREPARE</li>
<li>案例3.2，在B’上接收PRE-PREPARE：在B’上广播PREPARE。<ul>
<li>注意：由于+2&#x2F;3被锁定在B并且这将导致全面更改，因此此共识轮将最终进行全面更改。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>PREPARE</code>:</p>
<ul>
<li>案例1，验证器被锁定：<ul>
<li>情况1.1，在B上接收PREPARE：在B上广播COMMIT，并进入PREPARED状态。<ul>
<li>注意：这不应该发生，它应该跳过这一步并在PRE-PREPARE阶段输入PREPARED。</li>
</ul>
</li>
<li>案例1.2，在B’上收到PREPARE：忽略。<ul>
<li>注意：B’上不应该有+1&#x2F;3 PREPARE，因为+2&#x2F;3被锁定在B.因此B’上的共识轮将导致轮次更改。 验证器不能直接在此广播ROUND CHANGE，因为此PREPARE消息可能来自故障节点。</li>
</ul>
</li>
</ul>
</li>
<li>情况2，验证器未锁定：<ul>
<li>情况2.1，在B上收到PREPARE：在B上等待2F + 1 PREPARE消息<ul>
<li>注意：在接收2F + 1 PREPARE消息之前，它很可能会收到2F + 1 COMMIT消息，因为有+2&#x2F;3验证器被锁定在B.在这种情况下，它将直接跳转到COMMITTED状态。</li>
</ul>
</li>
<li>情况2.2，在B’上收到PREPARE：在B’上等待2F + 1 PREPARE消息。<ul>
<li>Note: This consensus will eventually get into round change since <code>+2/3</code> validators are locked on <code>B</code> and which would lead to round change.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>COMMIT</code>:</p>
<ul>
<li>验证者必须被锁定：<ul>
<li>情况1，在B上收到COMMIT：等待2F + 1 COMMIT消息。</li>
<li>案例2，B’收到COMMIT：不应该发生。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="锁定情况下"><a href="#锁定情况下" class="headerlink" title="锁定情况下"></a>锁定情况下</h4><ul>
<li>Round change:<ul>
<li>Case 1, <code>+2/3</code> are locked:<ul>
<li>如果提议者被锁定，则建议B.</li>
<li>否则它会提出B’，但这将导致另一轮变革。</li>
<li>结论：最终B将由诚实的验证者承诺。</li>
</ul>
</li>
<li>Case 2, <code>+1/3 ~ 2/3</code> are locked:<ul>
<li>如果提议者被锁定，则建议B.</li>
<li>否则它会提出B’。 但是，由于+1 &#x2F; 3被锁定在B，因此没有验证器可以在B’上接收2F + 1 PREPARE，这意味着没有验证器可以锁定在B’。 此外，那些+1 &#x2F; 3锁定验证器将不会响应B’并最终导致全面更改。</li>
<li>结论：最终B将由诚实的验证者承诺。</li>
</ul>
</li>
<li>Case 3, <code>-1/3</code> are locked:<ul>
<li>如果提议被锁定，则建议B.</li>
<li>否则它会提出B’。 如果+2&#x2F;3在B’上达成共识，那些锁定的-1&#x2F;3将通过同步获得B’并移动到下一个高度。 否则，将会有另一轮变更。</li>
<li>结论：它可以是B或其他块B’最终提交。</li>
</ul>
</li>
</ul>
</li>
<li>插入失败导致的round change：<ul>
<li>它将属于上述一轮变更案例之一。<ul>
<li>如果块实际上是坏的（不能插入区块链），最终+2&#x2F;3验证器将在H处解锁块B并尝试建议新的块B’。</li>
<li>如果块是好的（可以插入区块链），那么它仍然是上述圆形更改案例之一。</li>
</ul>
</li>
</ul>
</li>
<li>-1&#x2F;3验证器成功插入块，但其他验证器成功触发循环更改，这意味着+1 &#x2F; 3仍锁定在锁定（B，H）<ul>
<li>案例1，提议者已插入B：提议者将在H’提出B’，但+1 &#x2F; 3被锁定在B，因此B’将不会通过共识，这最终将导致轮次更改。 其他验证器将对B执行共识或通过同步获得B.</li>
<li>案例2，提议者未插入B：<ul>
<li>案例2.1，提议者被锁定：提议者提出B.</li>
<li>案例2.2，提议者未被锁定：提议者将在H处提出B’。其余与上述案例1相同。</li>
</ul>
</li>
</ul>
</li>
<li>+1&#x2F;3验证器成功插入块，-2 &#x2F; 3试图在H处触发圆形更改<ul>
<li>案例1，提议者已插入B：提议者将在H’提出B’，但在+1&#x2F;3通过同步获得B之前不会通过共识。</li>
<li>案例2，提议者未插入B：<ul>
<li>案例2.1，提议者被锁定：提议者提出B.</li>
<li>案例2.2，提议者未被锁定：提议者在H处提出B’。其余与上述案例1相同。</li>
</ul>
</li>
</ul>
</li>
<li>+2&#x2F;3验证器成功插入块，-1 &#x2F; 3试图在H处触发圆形更改<ul>
<li>案例1，提议者已插入B：提议者将在H’提出B’，这可能会导致成功的共识。 然后那些-1&#x2F;3需要通过同步获得B.</li>
<li>案例2，提议者未插入B：<ul>
<li>案例2.1，提议者被锁定：提议者提出B.</li>
<li>案例2.2，提议者没有被锁定：提议者在H处建议B’。因为+2&#x2F;3已经在H处有B，所以这一轮将导致轮次改变。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/jpmorganchase/quorum/issues/305">Fail-Stop failures</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1901.07160.pdf">这篇文章详细分析了IBFT</a></li>
<li>没有激励机制</li>
</ul>
<p>传统上，验证者需要紧密连接才能达到稳定的共识结果，这意味着所有验证者需要彼此直接连接; 但是，在实际的网络环境中，很难实现稳定和恒定的p2p连接。 为了解决这个问题，伊斯坦布尔BFT实施了八卦网络来克服这种限制。 在八卦网络环境中，所有验证器只需要弱连接，这意味着当它们直接连接或者它们之间连接有一个或多个验证器时，任何两个验证器都会被连接。 共识消息将在验证器之间中继。</p>
<hr>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p> <a target="_blank" rel="noopener" href="https://github.com/blockchainGuide">https://github.com/blockchainGuide</a> （文章合集最终修订版，会因为文章内容勘误不断更新，建议关注）</p>
<p> <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1901.07160.pdf">https://arxiv.org/pdf/1901.07160.pdf</a> （IBFT论文）</p>
<p> <a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/issues/650">https://github.com/ethereum/EIPs/issues/650</a> </p>
<p> <a target="_blank" rel="noopener" href="https://github.com/ConsenSys/quorum/issues/305">https://github.com/ConsenSys/quorum/issues/305</a> </p>
<p> <a target="_blank" rel="noopener" href="https://docs.goquorum.consensys.net/en/stable/Concepts/Consensus/IBFT/">https://docs.goquorum.consensys.net/en/stable/Concepts/Consensus/IBFT/</a> （quorum的官方的文档）</p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95/" rel="tag"># 共识算法</a>
              <a href="/tags/IBFT/" rel="tag"># IBFT</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_EOS_DPOS_BFT%E7%AE%97%E6%B3%95-5/" rel="prev" title="死磕共识算法|DPOS(委托股权证明)算法">
      <i class="fa fa-chevron-left"></i> 死磕共识算法|DPOS(委托股权证明)算法
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/08/26/%E6%AD%BB%E7%A3%95%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95_Paxos%E7%AE%97%E6%B3%95-5/" rel="next" title="死磕共识算法|Paxos算法">
      死磕共识算法|Paxos算法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AF%E8%AF%AD"><span class="nav-number">2.</span> <span class="nav-text">术语</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IBFT%E5%85%B1%E8%AF%86%E7%BB%86%E8%8A%82"><span class="nav-number">2.0.1.</span> <span class="nav-text">IBFT共识细节</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B1%E8%AF%86%E7%8A%B6%E6%80%81"><span class="nav-number">2.0.1.1.</span> <span class="nav-text">共识状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2"><span class="nav-number">2.0.1.2.</span> <span class="nav-text">状态转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Round-change-flow"><span class="nav-number">2.0.1.3.</span> <span class="nav-text">Round change flow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Proposer-%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5"><span class="nav-number">2.0.1.4.</span> <span class="nav-text">Proposer 选择策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Validator-%E5%88%97%E8%A1%A8%E6%8A%95%E7%A5%A8"><span class="nav-number">2.0.1.5.</span> <span class="nav-text">Validator 列表投票</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AA%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%E5%92%8Cbacklog"><span class="nav-number">2.0.1.6.</span> <span class="nav-text">未来的消息和backlog</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">2.0.1.7.</span> <span class="nav-text">优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F"><span class="nav-number">2.0.1.8.</span> <span class="nav-text">常量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9D%97%E5%A4%B4"><span class="nav-number">2.0.1.9.</span> <span class="nav-text">块头</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Block-hash-proposer-seal-and-committed-seals"><span class="nav-number">2.0.2.</span> <span class="nav-text">Block hash, proposer seal, and committed seals</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%8F%90%E8%AE%AE%E8%80%85seal"><span class="nav-number">2.0.2.0.1.</span> <span class="nav-text">计算提议者seal</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%9D%97%E5%93%88%E5%B8%8C"><span class="nav-number">2.0.2.0.2.</span> <span class="nav-text">计算块哈希</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B1%E8%AF%86%E8%AF%81%E6%98%8E"><span class="nav-number">2.0.2.0.3.</span> <span class="nav-text">共识证明</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9D%97%E9%94%81%E5%AE%9A%E6%9C%BA%E5%88%B6"><span class="nav-number">2.0.3.</span> <span class="nav-text">块锁定机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Lock"><span class="nav-number">2.0.3.1.</span> <span class="nav-text">Lock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lock-and-unlock"><span class="nav-number">2.0.3.2.</span> <span class="nav-text">Lock and unlock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Protocol-2-3-validators-are-locked-with-Lock-B-H"><span class="nav-number">2.0.3.3.</span> <span class="nav-text">Protocol (+2&#x2F;3 validators are locked with Lock(B,H))</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%81%E5%AE%9A%E6%83%85%E5%86%B5%E4%B8%8B"><span class="nav-number">2.0.3.4.</span> <span class="nav-text">锁定情况下</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.</span> <span class="nav-text">存在的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="mindcarver"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">mindcarver</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/mindcarver" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mindcarver" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/626984947@qq.com" title="E-Mail → 626984947@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/mindcarver001" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;mindcarver001" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mindcarver</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">335k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">5:05</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'mvGWtuPpkVTSqWCt8xxQ8x8p-gzGzoHsz',
      appKey     : 'IYnOZJ2Y6xvBXl8J1LtKZ59G',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
